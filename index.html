<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KonMari Moving Assistant</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✨</text></svg>">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Simple icon components
        const Camera = () => React.createElement('span', null, '📷');
        const Search = () => React.createElement('span', null, '🔍');
        const Edit2 = () => React.createElement('span', null, '✏️');
        const Trash2 = () => React.createElement('span', null, '🗑️');
        const Download = () => React.createElement('span', null, '⬇️');
        const Upload = () => React.createElement('span', null, '⬆️');
        const Share2 = () => React.createElement('span', null, '📤');
        const Copy = () => React.createElement('span', null, '📋');
        const Check = () => React.createElement('span', null, '✅');
        const Printer = () => React.createElement('span', null, '🖨️');
        const FileSpreadsheet = () => React.createElement('span', null, '📊');
        const Settings = () => React.createElement('span', null, '⚙️');
        const Users = () => React.createElement('span', null, '👥');
        const Plus = () => React.createElement('span', null, '➕');
        const Package = () => React.createElement('span', null, '📦');
        const Heart = () => React.createElement('span', null, '💝');

        function KonMariMovingAssistant() {
          const [boxes, setBoxes] = useState([]);
          const [currentBox, setCurrentBox] = useState({
            id: '',
            contents: '',
            location: 'storage',
            photo: null,
            sparksJoy: true
          });
          const [activeTab, setActiveTab] = useState('pack');
          const [searchTerm, setSearchTerm] = useState('');
          const [editingId, setEditingId] = useState(null);
          const [shareCode, setShareCode] = useState('');
          const [sessionId, setSessionId] = useState('');
          const [showShareModal, setShowShareModal] = useState(false);
          const [showSettingsModal, setShowSettingsModal] = useState(false);
          const [copied, setCopied] = useState(false);
          const [isConnected, setIsConnected] = useState(false);
          const [collaborators, setCollaborators] = useState([]);
          const [saveStatus, setSaveStatus] = useState('saved');
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [passwordInput, setPasswordInput] = useState('');
          const [showPassword, setShowPassword] = useState(false);
          const [settings, setSettings] = useState({
            printerConnected: false,
            printerType: 'dymo',
            googleSheetsConnected: true,
            spreadsheetId: '1YcU5Zfp8ndcpqxTOFi3yXfrUXYgnl-g3s9TO9bZV7qA',
            apiKey: 'AIzaSyBBU4986lv6Vil-ivXKsU5z0NbnqiGcoOw',
            smartNumbering: true,
            autoSync: true,
            userName: 'LC',
            autoGoogleSync: true
          });
          const cameraInputRef = useRef(null);
          const syncIntervalRef = useRef(null);

          const APP_PASSWORD = '170EEA';

          const locations = [
            { value: 'storage', label: 'Storage Unit', icon: '📦', color: 'bg-blue-50 border-blue-200 text-blue-700', prefix: 'ST' },
            { value: 'yips', label: 'Yips', icon: '🏡', color: 'bg-green-50 border-green-200 text-green-700', prefix: 'YP' },
            { value: 'lc', label: 'LC', icon: '👩', color: 'bg-purple-50 border-purple-200 text-purple-700', prefix: 'LC' },
            { value: 'jy', label: 'JY', icon: '👨', color: 'bg-orange-50 border-orange-200 text-orange-700', prefix: 'JY' }
          ];

          const generateSmartBoxId = () => {
            const locationInfo = locations.find(loc => loc.value === currentBox.location);
            const prefix = locationInfo?.prefix || 'BX';
            const locationBoxes = boxes.filter(box => box.location === currentBox.location);
            const number = locationBoxes.length + 1;
            return `${prefix}-${number.toString().padStart(3, '0')}`;
          };

          const saveToMultipleLocations = (data) => {
            setSaveStatus('saving');
            try {
              localStorage.setItem('konmari_boxes', JSON.stringify(data.boxes || []));
              localStorage.setItem('konmari_settings', JSON.stringify(data.settings || settings));
              sessionStorage.setItem('konmari_backup', JSON.stringify(data));
              
              const timestampedData = {
                ...data,
                lastSaved: new Date().toISOString(),
                version: '1.0'
              };
              localStorage.setItem('konmari_full_backup', JSON.stringify(timestampedData));
              
              setSaveStatus('saved');
              return true;
            } catch (error) {
              console.error('Save failed:', error);
              setSaveStatus('error');
              return false;
            }
          };

          const loadSavedData = () => {
            try {
              const savedBoxes = localStorage.getItem('konmari_boxes');
              const savedSettings = localStorage.getItem('konmari_settings');
              
              if (savedBoxes) {
                const parsedBoxes = JSON.parse(savedBoxes);
                setBoxes(parsedBoxes);
                console.log(`Loaded ${parsedBoxes.length} boxes from storage`);
              }
              
              if (savedSettings) {
                const parsedSettings = JSON.parse(savedSettings);
                setSettings(prev => ({ ...prev, ...parsedSettings }));
              }
              
              if (!savedBoxes) {
                const backupData = sessionStorage.getItem('konmari_backup');
                if (backupData) {
                  const parsed = JSON.parse(backupData);
                  if (parsed.boxes) {
                    setBoxes(parsed.boxes);
                    console.log(`Restored ${parsed.boxes.length} boxes from backup`);
                  }
                }
              }
            } catch (error) {
              console.error('Load failed:', error);
              setSaveStatus('error');
            }
          };

          const syncToGoogleSheets = async (boxesData) => {
            if (!settings.googleSheetsConnected || !settings.spreadsheetId || !settings.apiKey) {
              console.log('Google Sheets not configured');
              return false;
            }
            
            try {
              console.log('Starting Google Sheets sync...');
              console.log('Spreadsheet ID:', settings.spreadsheetId);
              console.log('Number of boxes:', boxesData.length);
              
              const headers = ['Box ID', 'Contents', 'Location', 'Packed By', 'Date Created', 'QR Code', 'Photo URL'];
              const sheetData = [
                headers,
                ...boxesData.map(box => [
                  box.id || '',
                  box.contents || '',
                  locations.find(l => l.value === box.location)?.label || '',
                  box.packedBy || '',
                  box.timestamp ? new Date(box.timestamp).toLocaleDateString() : '',
                  `KONMARI-${box.id}`,
                  box.photo ? 'Photo attached' : 'No photo'
                ])
              ];
              
              // First, try to clear existing data
              const clearUrl = `https://sheets.googleapis.com/v4/spreadsheets/${settings.spreadsheetId}/values/Sheet1:clear?key=${settings.apiKey}`;
              console.log('Clearing sheet...');
              
              const clearResponse = await fetch(clearUrl, {
                method: 'POST',
                headers: { 
                  'Content-Type': 'application/json',
                  'Accept': 'application/json'
                },
                body: JSON.stringify({})
              });
              
              if (!clearResponse.ok) {
                const clearError = await clearResponse.text();
                console.error('Clear failed:', clearError);
                throw new Error(`Clear failed: ${clearResponse.status} - ${clearError}`);
              }
              
              console.log('Sheet cleared successfully');
              
              // Then add new data
              const updateUrl = `https://sheets.googleapis.com/v4/spreadsheets/${settings.spreadsheetId}/values/Sheet1?valueInputOption=USER_ENTERED&key=${settings.apiKey}`;
              console.log('Adding data to sheet...');
              
              const updateResponse = await fetch(updateUrl, {
                method: 'PUT',
                headers: { 
                  'Content-Type': 'application/json',
                  'Accept': 'application/json'
                },
                body: JSON.stringify({ 
                  values: sheetData,
                  majorDimension: 'ROWS'
                })
              });
              
              if (!updateResponse.ok) {
                const updateError = await updateResponse.text();
                console.error('Update failed:', updateError);
                throw new Error(`Update failed: ${updateResponse.status} - ${updateError}`);
              }
              
              const result = await updateResponse.json();
              console.log('✅ Successfully synced to Google Sheets:', result);
              return true;
              
            } catch (error) {
              console.error('Google Sheets sync failed:', error);
              
              // Show specific error messages
              if (error.message.includes('403')) {
                alert('❌ Google Sheets Error: API key doesn\'t have permission. Please check:\n1. API key is correct\n2. Google Sheets API is enabled\n3. Sheet is shared publicly');
              } else if (error.message.includes('404')) {
                alert('❌ Google Sheets Error: Spreadsheet not found. Please check:\n1. Spreadsheet ID is correct\n2. Sheet is shared with "Anyone with link can edit"');
              } else if (error.message.includes('400')) {
                alert('❌ Google Sheets Error: Invalid request. The sheet might be protected or API key is invalid.');
              } else {
                alert(`❌ Google Sheets Error: ${error.message}\n\nPlease check your internet connection and try again.`);
              }
              
              return false;
            }
          };

          const syncToCloud = () => {
            const syncData = {
              boxes,
              timestamp: Date.now().toString(),
              lastUpdatedBy: settings.userName
            };
            
            if (shareCode) {
              localStorage.setItem(`sync_${shareCode}`, JSON.stringify(syncData));
            }
            
            saveToMultipleLocations({ boxes, settings });
            
            if (settings.autoGoogleSync && settings.googleSheetsConnected) {
              syncToGoogleSheets(boxes);
            }
          };

          const startRealtimeSync = () => {
            if (syncIntervalRef.current) {
              clearInterval(syncIntervalRef.current);
            }
            
            syncIntervalRef.current = setInterval(() => {
              const syncData = localStorage.getItem(`sync_${shareCode}`);
              if (syncData) {
                const { boxes: syncedBoxes, timestamp } = JSON.parse(syncData);
                const lastSync = localStorage.getItem('last_sync_timestamp') || '0';
                
                if (timestamp > lastSync) {
                  setBoxes(syncedBoxes || []);
                  localStorage.setItem('last_sync_timestamp', timestamp);
                }
              }
            }, 2000);
          };

          useEffect(() => {
            const authStatus = localStorage.getItem('konmari_auth');
            if (authStatus === 'authenticated') {
              setIsAuthenticated(true);
            }
            
            const newSessionId = Math.random().toString(36).substring(2, 15);
            setSessionId(newSessionId);
            setIsConnected(true);
            
            loadSavedData();
            
            return () => {
              if (syncIntervalRef.current) {
                clearInterval(syncIntervalRef.current);
              }
            };
          }, []);

          useEffect(() => {
            if (settings.autoSync && shareCode && isAuthenticated) {
              startRealtimeSync();
            }
          }, [settings.autoSync, shareCode, isAuthenticated]);

          const handleLogin = () => {
            if (passwordInput === APP_PASSWORD) {
              setIsAuthenticated(true);
              localStorage.setItem('konmari_auth', 'authenticated');
              setPasswordInput('');
            } else {
              alert('Incorrect password. Please try again.');
              setPasswordInput('');
            }
          };

          const handleLogout = () => {
            setIsAuthenticated(false);
            localStorage.removeItem('konmari_auth');
            setPasswordInput('');
          };

          const generateShareCode = () => {
            const code = Math.random().toString(36).substring(2, 8).toUpperCase();
            setShareCode(code);
            setShowShareModal(true);
            syncToCloud();
            setCollaborators([{ name: settings.userName, id: sessionId, active: true }]);
          };

          const joinSession = (code) => {
            setShareCode(code.toUpperCase());
            const syncData = localStorage.getItem(`sync_${code.toUpperCase()}`);
            if (syncData) {
              const { boxes: sharedBoxes } = JSON.parse(syncData);
              setBoxes(sharedBoxes || []);
              
              const existingCollabs = JSON.parse(localStorage.getItem(`collaborators_${code}`) || '[]');
              const newCollab = { name: settings.userName, id: sessionId, active: true };
              const updatedCollabs = [...existingCollabs.filter(c => c.id !== sessionId), newCollab];
              setCollaborators(updatedCollabs);
              localStorage.setItem(`collaborators_${code}`, JSON.stringify(updatedCollabs));
              
              startRealtimeSync();
              alert('Successfully joined the session!');
            } else {
              alert('Session code not found. Make sure the code is correct.');
            }
          };

          const printLabel = (box) => {
            if (!settings.printerConnected) {
              alert('Please connect your label printer in settings first.');
              return;
            }
            alert(`Printing label for box ${box.id}...`);
          };

          const exportToGoogleSheets = async () => {
            setSaveStatus('saving');
            const success = await syncToGoogleSheets(boxes);
            
            if (success) {
              setSaveStatus('saved');
              alert(`✅ Successfully exported ${boxes.length} boxes to Google Sheets!`);
            } else {
              setSaveStatus('error');
              alert('❌ Failed to export to Google Sheets. Check your internet connection.');
            }
          };

          const copyShareCode = () => {
            navigator.clipboard.writeText(shareCode);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          };

          const handlePhotoCapture = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                setCurrentBox(prev => ({ ...prev, photo: event.target.result }));
              };
              reader.readAsDataURL(file);
            }
          };

          const addBox = () => {
            if (!currentBox.contents.trim()) {
              alert('Please describe what\'s in the box');
              return;
            }

            const newBox = {
              ...currentBox,
              id: generateSmartBoxId(),
              timestamp: new Date().toISOString(),
              packedBy: settings.userName
            };

            setBoxes(prev => [...prev, newBox]);
            resetForm();
            syncToCloud();
          };

          const resetForm = () => {
            setCurrentBox({
              id: '',
              contents: '',
              location: 'storage',
              photo: null,
              sparksJoy: true
            });
            setEditingId(null);
          };

          const updateBox = () => {
            setBoxes(prev => prev.map(box => 
              box.id === editingId ? { ...currentBox, id: editingId, packedBy: settings.userName } : box
            ));
            resetForm();
            syncToCloud();
          };

          const editBox = (box) => {
            setCurrentBox(box);
            setEditingId(box.id);
          };

          const deleteBox = (id) => {
            setBoxes(prev => prev.filter(box => box.id !== id));
            syncToCloud();
          };

          const saveSettings = () => {
            localStorage.setItem('konmari_settings', JSON.stringify(settings));
            setShowSettingsModal(false);
            
            if (settings.autoSync && shareCode) {
              startRealtimeSync();
            }
          };

          const filteredBoxes = boxes.filter(box => 
            box.contents.toLowerCase().includes(searchTerm.toLowerCase()) ||
            box.id.toLowerCase().includes(searchTerm.toLowerCase())
          );

          const exportData = () => {
            const dataStr = JSON.stringify({ boxes, settings }, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'konmari-moving-inventory.json';
            link.click();
          };

          const importData = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const data = JSON.parse(event.target.result);
                  setBoxes(data.boxes || []);
                  if (data.settings) {
                    setSettings(prev => ({ ...prev, ...data.settings }));
                  }
                  syncToCloud();
                  alert('Data imported successfully!');
                } catch (error) {
                  alert('Error importing data. Please check the file format.');
                }
              };
              reader.readAsText(file);
            }
          };

          const getLocationInfo = (location) => {
            return locations.find(loc => loc.value === location) || locations[0];
          };

          if (!isAuthenticated) {
            return React.createElement('div', {
              className: "min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center p-4"
            }, React.createElement('div', {
              className: "bg-white rounded-3xl shadow-xl p-8 max-w-sm w-full"
            }, 
              React.createElement('div', { className: "text-center mb-8" },
                React.createElement('h1', { className: "text-2xl font-light text-gray-800 mb-2" }, "✨ KonMari Moving"),
                React.createElement('p', { className: "text-gray-600 text-sm" }, "Private access for LC & JY")
              ),
              React.createElement('div', { className: "space-y-4" },
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Enter Password"),
                  React.createElement('div', { className: "relative" },
                    React.createElement('input', {
                      type: showPassword ? "text" : "password",
                      value: passwordInput,
                      onChange: (e) => setPasswordInput(e.target.value),
                      onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
                      placeholder: "Password",
                      className: "w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    }),
                    React.createElement('button', {
                      type: "button",
                      onClick: () => setShowPassword(!showPassword),
                      className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                    }, showPassword ? '🙈' : '👁️')
                  )
                ),
                React.createElement('button', {
                  onClick: handleLogin,
                  className: "w-full bg-blue-600 text-white py-3 px-6 rounded-2xl hover:bg-blue-700 transition-all duration-200 font-medium"
                }, "Access App")
              ),
              React.createElement('div', { className: "mt-6 text-center text-xs text-gray-400" },
                React.createElement('p', null, "Secure access for authorized users only")
              )
            ));
          }

          return React.createElement('div', {
            className: "min-h-screen bg-gradient-to-br from-pink-50 to-purple-50"
          }, React.createElement('div', {
            className: "max-w-md mx-auto p-4 pb-20"
          },
            React.createElement('div', { className: "text-center mb-6" },
              React.createElement('h1', { className: "text-2xl font-light text-gray-800 mb-1" }, "✨ KonMari Moving"),
              React.createElement('p', { className: "text-gray-600 text-sm font-light" }, "Keep only what sparks joy"),
              React.createElement('div', { className: "flex justify-center items-center gap-2 mt-2" },
                saveStatus === 'saving' && React.createElement('div', { className: "flex items-center gap-1 text-blue-600 text-xs" },
                  React.createElement('span', null, '💾'),
                  React.createElement('span', null, 'Saving...')
                ),
                saveStatus === 'saved' && React.createElement('div', { className: "flex items-center gap-1 text-green-600 text-xs" },
                  React.createElement('span', null, '✅'),
                  React.createElement('span', null, 'Saved')
                ),
                saveStatus === 'error' && React.createElement('div', { className: "flex items-center gap-1 text-red-600 text-xs" },
                  React.createElement('span', null, '⚠️'),
                  React.createElement('span', null, 'Save Error')
                ),
                isConnected && collaborators.length > 1 && React.createElement('div', { className: "flex items-center gap-1 text-green-600 text-xs ml-2" },
                  React.createElement(Users),
                  React.createElement('span', null, `${collaborators.length} users`)
                )
              )
            ),
            React.createElement('div', { className: "flex gap-2 mb-6" },
              React.createElement('button', {
                onClick: generateShareCode,
                className: "flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-2xl hover:bg-indigo-700 transition-all duration-200 text-sm"
              },
                React.createElement(Share2),
                shareCode ? 'Share' : 'Collaborate'
              ),
              React.createElement('button', {
                onClick: exportToGoogleSheets,
                className: "flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded-2xl hover:bg-green-700 transition-all duration-200 text-sm"
              },
                React.createElement(FileSpreadsheet),
                'Sheets'
              ),
              React.createElement('button', {
                onClick: () => setShowSettingsModal(true),
                className: "flex items-center gap-1 px-3 py-2 bg-gray-600 text-white rounded-2xl hover:bg-gray-700 transition-all duration-200 text-sm"
              },
                React.createElement(Settings)
              ),
              React.createElement('button', {
                onClick: handleLogout,
                className: "flex items-center gap-1 px-2 py-2 bg-red-500 text-white rounded-2xl hover:bg-red-600 transition-all duration-200 text-sm",
                title: "Logout"
              }, '🚪')
            ),
            React.createElement('div', { className: "grid grid-cols-4 gap-2 mb-6" },
              locations.map(loc => 
                React.createElement('div', {
                  key: loc.value,
                  className: `${loc.color} rounded-2xl p-3 border text-center`
                },
                  React.createElement('div', { className: "text-lg mb-1" }, loc.icon),
                  React.createElement('div', { className: "text-lg font-light" }, boxes.filter(box => box.location === loc.value).length),
                  React.createElement('div', { className: "text-xs font-medium" }, loc.label)
                )
              )
            ),
            React.createElement('div', { className: "flex bg-white rounded-full p-1 shadow-lg border mb-6" },
              React.createElement('button', {
                onClick: () => setActiveTab('pack'),
                className: `flex-1 py-2 px-4 rounded-full transition-all duration-200 text-sm ${
                  activeTab === 'pack' 
                    ? 'bg-blue-600 text-white shadow-md' 
                    : 'text-gray-600 hover:text-blue-600'
                }`
              },
                React.createElement(Plus, { className: "inline mr-1" }),
                'Pack'
              ),
              React.createElement('button', {
                onClick: () => setActiveTab('boxes'),
                className: `flex-1 py-2 px-4 rounded-full transition-all duration-200 text-sm ${
                  activeTab === 'boxes' 
                    ? 'bg-blue-600 text-white shadow-md' 
                    : 'text-gray-600 hover:text-blue-600'
                }`
              },
                React.createElement(Package, { className: "inline mr-1" }),
                `Boxes (${boxes.length})`
              )
            ),
            activeTab === 'pack' && React.createElement('div', { className: "bg-white rounded-3xl shadow-xl p-6 border" },
              React.createElement('h2', { className: "text-xl font-light text-center mb-6 text-gray-800" },
                editingId ? 'Edit Box' : '📦 Pack a Box'
              ),
              React.createElement('div', { className: "space-y-4" },
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Photo (optional)"),
                  React.createElement('button', {
                    onClick: () => cameraInputRef.current?.click(),
                    className: "w-full h-32 border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center hover:border-blue-400 transition-colors"
                  },
                    currentBox.photo ? React.createElement('img', {
                      src: currentBox.photo,
                      alt: "Box contents",
                      className: "w-full h-full object-cover rounded-2xl"
                    }) : React.createElement(React.Fragment, null,
                      React.createElement(Camera, { className: "text-gray-400 mb-2 text-2xl" }),
                      React.createElement('span', { className: "text-sm text-gray-500" }, "Tap to add photo (optional)")
                    )
                  ),
                  React.createElement('input', {
                    ref: cameraInputRef,
                    type: "file",
                    accept: "image/*",
                    capture: "environment",
                    onChange: handlePhotoCapture,
                    className: "hidden"
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Describe contents"),
                  React.createElement('textarea', {
                    value: currentBox.contents,
                    onChange: (e) => setCurrentBox(prev => ({ ...prev, contents: e.target.value })),
                    placeholder: "Winter clothes, books, kitchen items...",
                    rows: 3,
                    className: "w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Where is this going?"),
                  React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                    locations.map(loc => 
                      React.createElement('button', {
                        key: loc.value,
                        onClick: () => setCurrentBox(prev => ({ ...prev, location: loc.value })),
                        className: `p-3 rounded-2xl border-2 transition-all duration-200 ${
                          currentBox.location === loc.value ? loc.color : 'border-gray-200 hover:border-gray-300'
                        }`
                      },
                        React.createElement('div', { className: "text-lg mb-1" }, loc.icon),
                        React.createElement('div', { className: "text-xs font-medium" }, loc.label)
                      )
                    )
                  )
                ),
                React.createElement('div', { className: "flex gap-3 pt-4" },
                  React.createElement('button', {
                    onClick: editingId ? updateBox : addBox,
                    className: "flex-1 bg-green-600 text-white py-3 px-6 rounded-2xl hover:bg-green-700 transition-all duration-200 font-medium flex items-center justify-center gap-2"
                  },
                    React.createElement(Heart),
                    editingId ? 'Update Box' : 'Pack Box'
                  ),
                  editingId && React.createElement('button', {
                    onClick: resetForm,
                    className: "px-6 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition-all duration-200"
                  }, "Cancel")
                )
              )
            ),
            activeTab === 'boxes' && React.createElement('div', null,
              React.createElement('div', { className: "mb-4" },
                React.createElement('div', { className: "relative" },
                  React.createElement(Search, { className: "absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400" }),
                  React.createElement('input', {
                    type: "text",
                    value: searchTerm,
                    onChange: (e) => setSearchTerm(e.target.value),
                    placeholder: "Search your boxes...",
                    className: "w-full pl-12 pr-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                  })
                )
              ),
              React.createElement('div', { className: "space-y-4" },
                filteredBoxes.map(box => {
                  const locationInfo = getLocationInfo(box.location);
                  return React.createElement('div', {
                    key: box.id,
                    className: "bg-white rounded-2xl shadow-lg p-4 border"
                  },
                    React.createElement('div', { className: "flex justify-between items-start mb-3" },
                      React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-lg font-bold text-blue-600" }, box.id),
                        React.createElement('div', { className: `px-2 py-1 rounded-full text-xs ${locationInfo.color} border` },
                          locationInfo.icon + ' ' + locationInfo.label
                        )
                      ),
                      React.createElement('div', { className: "flex gap-1" },
                        React.createElement('button', {
                          onClick: () => printLabel(box),
                          className: "text-purple-600 hover:text-purple-800 p-1"
                        }, React.createElement(Printer)),
                        React.createElement('button', {
                          onClick: () => editBox(box),
                          className: "text-blue-600 hover:text-blue-800 p-1"
                        }, React.createElement(Edit2)),
                        React.createElement('button', {
                          onClick: () => deleteBox(box.id),
                          className: "text-red-600 hover:text-red-800 p-1"
                        }, React.createElement(Trash2))
                      )
                    ),
                    box.photo && React.createElement('img', {
                      src: box.photo,
                      alt: `Box ${box.id}`,
                      className: "w-full h-32 object-cover rounded-xl mb-3"
                    }),
                    React.createElement('p', { className: "text-gray-700 text-sm mb-2" }, box.contents),
                    box.packedBy && React.createElement('div', { className: "text-xs text-gray-400" },
                      `Packed by ${box.packedBy}`
                    )
                  );
                })
              ),
              filteredBoxes.length === 0 && React.createElement('div', { className: "text-center py-12" },
                React.createElement('div', { className: "text-4xl mb-4" }, '📦'),
                React.createElement('p', { className: "text-gray-500" },
                  searchTerm ? 'No boxes match your search.' : 'No boxes yet. Start packing!'
                )
              )
            ),
            showShareModal && React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" },
              React.createElement('div', { className: "bg-white rounded-3xl p-6 max-w-sm w-full" },
                React.createElement('h3', { className: "text-lg font-semibold mb-4 text-center" }, "Share Session"),
                React.createElement('p', { className: "text-gray-600 mb-4 text-center text-sm" }, "Share this code with your partner:"),
                React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                  React.createElement('div', { className: "flex-1 bg-gray-100 rounded-2xl p-3 text-center" },
                    React.createElement('span', { className: "text-xl font-bold text-blue-600" }, shareCode)
                  ),
                  React.createElement('button', {
                    onClick: copyShareCode,
                    className: "flex items-center gap-1 px-3 py-2 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-colors text-sm"
                  },
                    copied ? React.createElement(Check) : React.createElement(Copy),
                    copied ? 'Copied!' : 'Copy'
                  )
                ),
                React.createElement('div', { className: "space-y-3" },
                  React.createElement('div', null,
                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Join existing session:"),
                    React.createElement('div', { className: "flex gap-2" },
                      React.createElement('input', {
                        type: "text",
                        placeholder: "Enter code",
                        className: "flex-1 px-3 py-2 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",
                        onKeyPress: (e) => e.key === 'Enter' && joinSession(e.target.value)
                      }),
                      React.createElement('button', {
                        onClick: (e) => {
                          const input = e.target.previousElementSibling;
                          joinSession(input.value);
                        },
                        className: "px-4 py-2 bg-green-600 text-white rounded-2xl hover:bg-green-700 transition-colors text-sm"
                      }, "Join")
                    )
                  )
                ),
                React.createElement('button', {
                  onClick: () => setShowShareModal(false),
                  className: "w-full mt-4 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition-colors"
                }, "Close")
              )
            ),
            showSettingsModal && React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" },
              React.createElement('div', { className: "bg-white rounded-3xl p-6 max-w-sm w-full max-h-[80vh] overflow-y-auto" },
                React.createElement('h3', { className: "text-lg font-semibold mb-4 text-center" }, "Settings"),
                React.createElement('div', { className: "space-y-4" },
                  React.createElement('div', null,
                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Who are you?"),
                    React.createElement('select', {
                      value: settings.userName,
                      onChange: (e) => setSettings(prev => ({ ...prev, userName: e.target.value })),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500"
                    },
                      React.createElement('option', { value: "LC" }, "LC"),
                      React.createElement('option', { value: "JY" }, "JY")
                    )
                  ),
                  React.createElement('div', { className: "border-t pt-4" },
                    React.createElement('h4', { className: "font-medium text-gray-800 mb-2" }, "Label Printer"),
                    React.createElement('label', { className: "flex items-center gap-2 mb-2" },
                      React.createElement('input', {
                        type: "checkbox",
                        checked: settings.printerConnected,
                        onChange: (e) => setSettings(prev => ({ ...prev, printerConnected: e.target.checked })),
                        className: "w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                      }),
                      React.createElement('span', { className: "text-sm" }, "Printer connected")
                    )
                  ),
                  React.createElement('div', { className: "border-t pt-4" },
                    React.createElement('h4', { className: "font-medium text-gray-800 mb-2" }, "Google Sheets"),
                    React.createElement('div', { className: "bg-green-50 border border-green-200 rounded-2xl p-3 mb-3" },
                      React.createElement('div', { className: "flex items-center gap-2 text-green-700 text-sm" },
                        React.createElement('span', null, '✅'),
                        React.createElement('span', null, 'Connected to your Google Sheet')
                      ),
                      React.createElement('div', { className: "text-xs text-green-600 mt-1" },
                        `Auto-syncing to: ...${settings.spreadsheetId.slice(-10)}`
                      )
                    ),
                    React.createElement('label', { className: "flex items-center gap-2 mb-2" },
                      React.createElement('input', {
                        type: "checkbox",
                        checked: settings.autoGoogleSync,
                        onChange: (e) => setSettings(prev => ({ ...prev, autoGoogleSync: e.target.checked })),
                        className: "w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                      }),
                      React.createElement('span', { className: "text-sm" }, "Auto-sync every box to Google Sheets")
                    ),
                    React.createElement('button', {
                      onClick: exportToGoogleSheets,
                      className: "w-full mt-2 px-3 py-2 bg-green-600 text-white rounded-2xl hover:bg-green-700 transition-colors text-sm"
                    }, "📊 Sync Now to Google Sheets"),
                    React.createElement('button', {
                      onClick: async () => {
                        // Test API key and permissions
                        try {
                          const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${settings.spreadsheetId}?key=${settings.apiKey}`;
                          const response = await fetch(testUrl);
                          if (response.ok) {
                            const data = await response.json();
                            alert(`✅ Connection Test Successful!\nSheet Title: ${data.properties.title}\nAPI Key: Working`);
                          } else {
                            const error = await response.text();
                            alert(`❌ Connection Test Failed:\n${response.status} - ${error}`);
                          }
                        } catch (error) {
                          alert(`❌ Connection Test Error:\n${error.message}`);
                        }
                      },
                      className: "w-full mt-2 px-3 py-2 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-colors text-sm"
                    }, "🔧 Test Google Sheets Connection")
                  ),
                  React.createElement('div', { className: "border-t pt-4" },
                    React.createElement('label', { className: "flex items-center gap-2" },
                      React.createElement('input', {
                        type: "checkbox",
                        checked: settings.autoSync,
                        onChange: (e) => setSettings(prev => ({ ...prev, autoSync: e.target.checked })),
                        className: "w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                      }),
                      React.createElement('span', { className: "text-sm" }, "Auto-sync with partner")
                    )
                  ),
                  React.createElement('div', { className: "border-t pt-4" },
                    React.createElement('div', { className: "flex gap-2 text-sm" },
                      React.createElement('button', {
                        onClick: exportData,
                        className: "flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-gray-600 text-white rounded-2xl hover:bg-gray-700 transition-all duration-200"
                      },
                        React.createElement(Download),
                        'Export'
                      ),
                      React.createElement('label', { className: "flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-gray-600 text-white rounded-2xl hover:bg-gray-700 transition-all duration-200 cursor-pointer" },
                        React.createElement(Upload),
                        'Import',
                        React.createElement('input', {
                          type: "file",
                          accept: ".json",
                          onChange: importData,
                          className: "hidden"
                        })
                      ),
                      React.createElement('button', {
                        onClick: () => {
                          const dataStr = JSON.stringify({ boxes, settings, backupDate: new Date().toISOString() }, null, 2);
                          const dataBlob = new Blob([dataStr], { type: 'application/json' });
                          const url = URL.createObjectURL(dataBlob);
                          const link = document.createElement('a');
                          link.href = url;
                          link.download = `konmari-manual-backup-${new Date().toISOString().split('T')[0]}.json`;
                          link.click();
                          alert('✅ Manual backup downloaded!');
                        },
                        className: "flex items-center justify-center gap-1 px-3 py-2 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-all duration-200",
                        title: "Download Backup"
                      }, '💾')
                    )
                  )
                ),
                React.createElement('div', { className: "flex gap-2 mt-6" },
                  React.createElement('button', {
                    onClick: saveSettings,
                    className: "flex-1 py-3 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-colors"
                  }, "Save"),
                  React.createElement('button', {
                    onClick: () => setShowSettingsModal(false),
                    className: "px-6 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition-colors"
                  }, "Cancel")
                )
              )
            )
          ));
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(KonMariMovingAssistant));
    </script>
</body>
</html>
